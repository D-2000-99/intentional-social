DROP TABLE IF EXISTS notifications CASCADE; CREATE TABLE notifications (id SERIAL PRIMARY KEY, recipient_id INTEGER NOT NULL, actor_id INTEGER NOT NULL, post_id INTEGER NOT NULL, comment_id INTEGER, type VARCHAR(20) NOT NULL, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, read_at TIMESTAMP, FOREIGN KEY (recipient_id) REFERENCES users(id), FOREIGN KEY (actor_id) REFERENCES users(id), FOREIGN KEY (post_id) REFERENCES posts(id), FOREIGN KEY (comment_id) REFERENCES comments(id)); DROP INDEX IF EXISTS idx_notification_recipient; DROP INDEX IF EXISTS idx_notification_post; DROP INDEX IF EXISTS idx_notification_comment; DROP INDEX IF EXISTS idx_notification_recipient_read; DROP INDEX IF EXISTS idx_notification_recipient_post; DROP INDEX IF EXISTS idx_notification_recipient_comment; CREATE INDEX idx_notification_recipient ON notifications(recipient_id); CREATE INDEX idx_notification_post ON notifications(post_id); CREATE INDEX idx_notification_comment ON notifications(comment_id); CREATE INDEX idx_notification_recipient_read ON notifications(recipient_id, read_at); CREATE INDEX idx_notification_recipient_post ON notifications(recipient_id, post_id); CREATE INDEX idx_notification_recipient_comment ON notifications(recipient_id, comment_id);
